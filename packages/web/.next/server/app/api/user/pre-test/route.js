"use strict";(()=>{var e={};e.id=2710,e.ids=[2710],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27090:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>y,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{POST:()=>l});var a=r(63036),n=r(5736),o=r(15262),i=r(60942),c=r(82638),u=r(18808);async function l(e){try{let t=await (0,c.e)(),{data:{user:r}}=await t.auth.getUser();if(!r)return i.NextResponse.json({error:"Not authenticated"},{status:401});let s=await e.json(),a=await (0,u.q)(s);if(!a.success)return i.NextResponse.json({error:a.error},{status:400});return i.NextResponse.json({success:!0})}catch(e){return console.error("Pre-test save error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/user/pre-test/route",pathname:"/api/user/pre-test",filename:"route",bundlePath:"app/api/user/pre-test/route"},resolvedPagePath:"/workspace/packages/web/src/app/api/user/pre-test/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:v}=p,_="/api/user/pre-test/route";function y(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:m})}},18808:(e,t,r)=>{r.d(t,{h:()=>a,q:()=>n});var s=r(82638);async function a(){try{let e=await (0,s.e)(),{data:{user:t},error:r}=await e.auth.getUser();if(r||!t)return null;let{data:a,error:n}=await e.from("profiles").select("*").eq("id",t.id).single();if(n||!a)return null;let{count:o}=await e.from("activity_log").select("*",{count:"exact",head:!0}).eq("user_id",t.id),i=a?.plan_type||"free";return{user:{id:a?.id||"",email:a?.email||"",firstName:a?.name?.split(" ")[0],planType:i,trialEndDate:a?.trial_end_date,industry:a?.industry,companyName:a?.company_name,preTestCompleted:a?.pre_test_completed||!1},usage:{reconciliations:{current:0,limit:"trial"===i||"commercial"===i?"unlimited":1e3},playgroundRuns:{current:0,limit:"trial"===i||"commercial"===i?"unlimited":3}},recentJobs:[],metrics:{totalReconciliations:0,averageAccuracy:0,timeSaved:0,jobsCreated:0},isFirstVisit:0===(o||0)}}catch(e){return console.error("Error fetching user dashboard data:",e),null}}async function n(e){try{let t=await (0,s.e)(),{data:{user:r}}=await t.auth.getUser();if(!r)return{success:!1,error:"Not authenticated"};let{error:a}=await t.from("profiles").update({pre_test_completed:!0,pre_test_answers:e,industry:e.industry,updated_at:new Date().toISOString()}).eq("id",r.id);if(a)return{success:!1,error:a.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to save answers"}}}},82638:(e,t,r)=>{r.d(t,{e:()=>n,i:()=>o});var s=r(66603),a=r(9362);async function n(){let e=await (0,a.cookies)(),t=process.env.SUPABASE_URL||process.env.NEXT_PUBLIC_SUPABASE_URL||"",r=process.env.SUPABASE_ANON_KEY||process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"";return t&&r||console.warn("Supabase environment variables not set - some features may not work"),(0,s.createServerClient)(t,r,{cookies:{get:t=>e.get(t)?.value,set(t,r,s){try{e.set({name:t,value:r,...s})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})}async function o(){let e=process.env.SUPABASE_URL||process.env.NEXT_PUBLIC_SUPABASE_URL||"",t=process.env.SUPABASE_SERVICE_ROLE_KEY||"";e&&t||console.warn("Supabase admin environment variables not set - admin features may not work");let{createClient:s}=await Promise.resolve().then(r.bind(r,65365));return s(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4522,1920,1746],()=>r(27090));module.exports=s})();